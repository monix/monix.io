<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  
  
  <title>Monix: Version 2.0.4 Released for Bug Fixing</title>

  <link rel="canonical" href="https://monix.io/blog/2016/10/10/monix-v2.0.4.html" />

  <!-- Twitter Cards -->
  
  <meta name="twitter:card" content="summary">
  <meta name="twitter:image:src" content="https://monix.io/public/images/monix-logo-rect.png">
  <meta name="twitter:site" content="@monix" />  
  <meta name="twitter:creator" content="@monix" />  
  <meta name="twitter:title" content="Monix: Version 2.0.4 Released for Bug Fixing" />
  <meta name="twitter:description" content="Fixes an issue with AsyncScheduler" />
  <meta name="twitter:url" content="https://monix.io/blog/2016/10/10/monix-v2.0.4.html">
  <!-- Facebook Open-Graph -->
  <meta property="fb:app_id" content="2160100887367418" />

  <meta content="Monix" property="og:site_name">
  <meta content="Monix: Version 2.0.4 Released for Bug Fixing" property="og:title">
  <meta content="Fixes an issue with AsyncScheduler" property="og:description">
  <meta content="https://monix.io/blog/2016/10/10/monix-v2.0.4.html" property="og:url">
  <meta content="2016-10-10T00:00:00+00:00" property="article:published_time">
  <meta content="2016-10-24T06:47:53+00:00" property="article:modified_time">
    
  <meta content="article" property="og:type">
  <meta property="og:image" content="https://monix.io/public/images/monix-logo.png" />
  <meta property="og:image:secure_url" content="https://monix.io/public/images/monix-logo.png" />
  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/all.css?1635892346673077195">
  <!--[if lt IE 9]>
  <link rel="stylesheet" href="/public/css/forkme.ie.css?1635892346673077195">
  <![endif]-->

  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=PT+Sans:400,400italic,700|Abril+Fatface">

  <!-- Web App Manifest, see: http://manifest.sysapps.org/ -->
  <link rel="manifest" href="/manifest.json">
  <!-- Icons -->
  <link rel="icon" sizes="48x48" href="/public/icons/icon-48x48.png">
  <link rel="icon" sizes="72x72" href="/public/icons/icon-72x72.png">
  <link rel="icon" sizes="96x96" href="/public/icons/icon-96x96.png">
  <link rel="icon" sizes="144x144" href="/public/icons/icon-144x144.png">
  <link rel="icon" sizes="192x192" href="/public/icons/icon-192x192.png">
  <link rel="icon" sizes="240x240" href="/public/icons/icon-240x240.png">
  <link rel="icon" sizes="384x384" href="/public/icons/icon-384x384.png">
  <!-- Mobile Safari / iOS Icons -->
  <link rel="apple-touch-icon" sizes="48x48" href="/public/icons/icon-48x48.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/public/icons/icon-72x72.png">
  <link rel="apple-touch-icon" sizes="96x96" href="/public/icons/icon-96x96.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/public/icons/icon-144x144.png">
  <link rel="apple-touch-icon" sizes="192x192" href="/public/icons/icon-192x192.png">
  <link rel="apple-touch-icon" sizes="240x240" href="/public/icons/icon-240x240.png">
  <link rel="apple-touch-icon" sizes="384x384" href="/public/icons/icon-384x384.png">
  <!-- Standard Favicon -->
  <link rel="shortcut icon" href="/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/atom+xml" title="Feed" href="/blog/atom.xml">
</head>


  <body class="monix layout">
    <div class="wrapper">
      <aside class="sidebar plus">
  <div class="container">
    <div class="sidebar-about">
      <a class="github-fork-ribbon left-top" href="https://github.com/monix/monix"
        title="Fork me on GitHub">Fork me on GitHub</a>

      <h1>
        <a href="/">
          <img src="/public/images/monix-logo.png"
            alt="Monix Logo" title="Monix" class="logo" />
        </a>
      </h1>
    </div>

    <nav class="sidebar-nav">
      <a class="sidebar-nav-item" href="/">About</a>
      <a class="sidebar-nav-item active" href="/blog/">Blog</a>
      <a class="sidebar-nav-item" href="/docs/current/">Documentation</a>
      <a class="sidebar-nav-item" href="/presentations/">Presentations</a>
      <a class="sidebar-nav-item" href="/social.html">Follow @Monix</a>
      <a class="sidebar-nav-item" href="/privacy.html">Privacy Policy</a>
    </nav>
  </div>
</aside>


      <article class="content container">
        <div class="post">
  <a name="start"></a>
      <h1 class="post-title">
        
        
          Monix: Version 2.0.4 Released for Bug Fixing
        
        
      </h1>

  <time class="post-date" itemprop="dateCreated"
    datetime="2016-10-10">
    10 Oct 2016
    • <a href="https://twitter.com/alexelcu">@alexelcu</a>
  </time>

  <nav role="navigation" id="toc">
    <ul>
  <li><a href="#details">Details</a></li>
</ul>

  </nav>

  <p>This release is binary compatible with 2.0.x, being a bug fix release
for <a href="https://github.com/monix/monix/issues/244">Issue #244</a>:
<em><code class="language-plaintext highlighter-rouge">AsyncScheduler.scheduleAtFixedRate</code> and <code class="language-plaintext highlighter-rouge">scheduleWithFixedDelay</code> on the JVM
have incorrect behavior</em>.</p>

<p>In order to upgrade, just increment the version number in <code class="language-plaintext highlighter-rouge">build.sbt</code>:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">libraryDependencies</span> <span class="o">+=</span> <span class="s">"io.monix"</span> <span class="o">%%</span> <span class="s">"monix"</span> <span class="o">%</span> <span class="s">"2.0.4"</span>
</code></pre></div></div>

<!--more-->
    
      <h3 id="details">
        
        
          Details <a href="#details" class="anchor">#</a>
        
        
      </h3>

<p>The <code class="language-plaintext highlighter-rouge">AsyncScheduler.scheduleAtFixedRate</code> method implementation has
incorrect behavior and this includes <code class="language-plaintext highlighter-rouge">monix.execution.Scheduler.Implicits.global</code>.
Sample:</p>

<div class="language-scala highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">import</span> <span class="nn">java.util.concurrent.TimeUnit</span>
<span class="nv">monix</span><span class="o">.</span><span class="py">execution</span><span class="o">.</span><span class="py">Scheduler</span><span class="o">.</span><span class="py">Implicits</span><span class="o">.</span><span class="py">global</span>

<span class="nv">global</span><span class="o">.</span><span class="py">scheduleAtFixedRate</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="nv">TimeUnit</span><span class="o">.</span><span class="py">SECONDS</span><span class="o">,</span> <span class="n">runnable</span><span class="o">)</span>

<span class="nv">global</span><span class="o">.</span><span class="py">scheduleWithFixedDelay</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="nv">TimeUnit</span><span class="o">.</span><span class="py">SECONDS</span><span class="o">,</span> <span class="n">runnable</span><span class="o">)</span>
</code></pre></div></div>

<p>What happens is that if the given <code class="language-plaintext highlighter-rouge">runnable</code> takes more than 2 seconds to
execute, then subsequent runnables are going to be executed concurrently,
without waiting for the current runnable to finish. So if runnables are
slow, you can end up with 2 or even more runnables being executed
at the same time.</p>

<p>This happens because this periodic scheduling is deferred to the global
<code class="language-plaintext highlighter-rouge">Scheduler.DefaultScheduledExecutor</code> instance, a single threaded Java
<code class="language-plaintext highlighter-rouge">ScheduledExecutor</code> that then defers the actual execution of the task to the
<code class="language-plaintext highlighter-rouge">ForkJoinPool</code> in charge of the actual execution. But by doing this deferring,
the time it takes that runnable to execute is not taken into account at all.
This behavior is inconsistent with how these operations work for Java’s
<code class="language-plaintext highlighter-rouge">ScheduledExecutor</code> and with how they are documented in ScalaDoc.</p>

<p>NOTE: this behavior does NOT happen for <code class="language-plaintext highlighter-rouge">ExecutorScheduler</code>
(e.g. <code class="language-plaintext highlighter-rouge">Scheduler.io</code>, <code class="language-plaintext highlighter-rouge">Scheduler.fixedPool</code>, <code class="language-plaintext highlighter-rouge">Scheduler.singleThread</code>)
or any of the 2 available scheduler implementations for Javascript.
It also doesn’t affect <code class="language-plaintext highlighter-rouge">Observable.interval</code>, <code class="language-plaintext highlighter-rouge">Observable.intervalWithFixedDelay</code>
and <code class="language-plaintext highlighter-rouge">Observable.intervalAtFixedRate</code>. These observable builders have had
correct behavior, regardless of the scheduler used.</p>

<p>The fix involves the <code class="language-plaintext highlighter-rouge">AsyncScheduler</code> implementation to piggy-back on the
implementation in <code class="language-plaintext highlighter-rouge">ReferenceScheduler</code>, just like the Javascript scheduler
implementations.</p>

<p>Cheers,</p>


  <div class="related">
    
      <h2>
        
        
          Related Posts
        
        
      </h2>
    <ul class="related-posts">
      
        <li>
            <a href="/blog/2021/05/14/monix-v3.4.0.html">
              Monix 3.4.0
              <small>14 May 2021</small>
            </a>
        </li>
      
        <li>
            <a href="/blog/2020/11/07/monix-v3.3.0.html">
              Monix 3.3.0
              <small>07 Nov 2020</small>
            </a>
        </li>
      
        <li>
            <a href="/blog/2020/06/04/monix-v3.2.2.html">
              Monix 3.2.2
              <small>04 Jun 2020</small>
            </a>
        </li>
      
    </ul>
  </div>

  <div class="buttons">
    <a href="https://github.com/monix/monix.io/blob/master/_posts/2016-10-10-monix-v2.0.4.md">
      Edit Page</a> •
    <a href="https://twitter.com/alexelcu">
      Follow @alexelcu</a>
  </div>  

  
<div id="contributions">
    
      <h2 id="comments">
        
        
          Comments <a href="#comments" class="anchor">#</a>
        
        
      </h3>

  <script>
    document.write(
      '<div class="contributions-note">Be nice!<br><span class="contributions-note-extra">If you don\'t see the commenting widget, it might be blocked (see this <a href="https://github.com/utterance/utterances/issues/341" target="_blank">Privacy Badger issue</a>).</span></div>'
    );
  </script>
  <script
    src="https://utteranc.es/client.js"
    repo="monix/monix.io"
    issue-term="pathname"
    label="discussion"
    theme="github-light"
    crossorigin="anonymous"
    async
  ></script>
  <noscript>
    <div class="contributions-note">
      <strong>Enable JavaScript to see comments!</strong>
      <br />
      <span class="contributions-note-extra">
        Commenting widget is powered by GitHub's API and
        <a href="https://utteranc.es" target="_blank">utteranc.es</a>. This
        website does not track visitors or log personally identifiable
        information, see our
        <a href="/privacy.html">privacy policy</a>.
      </span>
    </div>
  </noscript>
</div>

</div>
      </article>
    </div>
    <script type="text/javascript">
  var _paq = window._paq || [];
  // Disabling cookies for privacy reasons
  _paq.push(['disableCookies']);
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="https://ly.monix.io/";
    _paq.push(['setTrackerUrl', u+'m.php']);
    _paq.push(['setSiteId', '2']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'m.js'; s.parentNode.insertBefore(g,s);
  })();
</script>
<noscript>
  
  <img src="https://ly.monix.io/m.php?idsite=2&rec=1&action_name=Monix%3A+Version+2.0.4+Released+for+Bug+Fixing" style="border:0" alt="" />
</noscript>


  </body>
</html>
